<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ランダムビンゴ（タップで開閉 & 開いた番号一覧）</title>
<style>
  :root { --bg:#fff; --fg:#222; --acc:#ff57b9; --acc2:#7aa7ff; --grid:#eee; }
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif; 
         background: var(--bg); color: var(--fg); margin: 0; padding: 16px; }
  .wrap { max-width: 560px; margin: 0 auto; }
  h1 { font-size: 1.25rem; margin: 0 0 12px; }
  .controls { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
  .controls button {
    border: 0; padding: 10px 14px; border-radius: 10px; cursor: pointer; font-weight: 600;
    background: var(--acc2); color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,.08);
  }
  .controls button.secondary { background: #aaa; }
  .controls button.pink { background: var(--acc); }
  .board {
    display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px;
    background: linear-gradient(#fff, #f9f9f9); padding: 10px; border-radius: 16px; 
    box-shadow: 0 6px 20px rgba(0,0,0,.08); border: 1px solid var(--grid);
    user-select: none; -webkit-user-select: none;
  }
  .cell, .head {
    aspect-ratio: 1 / 1; display: grid; place-items: center; 
    border-radius: 12px; border: 1px solid var(--grid);
    font-weight: 700; font-size: clamp(18px, 5vw, 26px); 
    background: #fff; position: relative; overflow: hidden;
    transition: transform .06s ease;
  }
  .head { background: #111; color: #fff; border-color: #111; font-size: clamp(18px, 5vw, 24px); letter-spacing: .08em; }
  .cell:active { transform: translateY(1px) scale(.99); }
  .cell.open {
    color: #fff; border-color: transparent;
    background: radial-gradient(120% 120% at 10% 10%, var(--acc) 0%, #ff8acb 40%, #ffa6d7 60%, #ffcfe8 100%);
  }
  .cell.free { background: repeating-conic-gradient(from 45deg, #f7f7f7 0 10deg, #fff 10deg 20deg); color:#888; }
  .cell.free.open { color:#fff; background: radial-gradient(120% 120% at 10% 10%, #999 0%, #bbb 50%, #ddd 100%); }
  .cell small { font-size: .6em; font-weight: 800; opacity: .5; position: absolute; top: 6px; right: 8px; }
  .legend { font-size: .9rem; color: #666; margin: 12px 2px 6px; display:flex; justify-content:space-between; align-items:center; }
  .called-box {
    min-height: 54px; border: 2px dashed var(--grid); border-radius: 12px; padding: 10px; background: #fff;
    display: flex; flex-wrap: wrap; gap: 8px;
  }
  .chip {
    padding: 6px 10px; border-radius: 999px; font-weight: 700; 
    background: #f2f6ff; border: 1px solid #dfe8ff;
  }
  .chip.b { background:#fff1f1; border-color:#ffd4d4; }
  .chip.i { background:#fff9e8; border-color:#ffe8b3; }
  .chip.n { background:#eefdf3; border-color:#c9f3d8; }
  .chip.g { background:#eef9ff; border-color:#cde9ff; }
  .chip.o { background:#f6eeff; border-color:#e0d0ff; }
  .foot { font-size:.8rem; color:#888; margin-top:10px; }
</style>
</head>
<body>
<div class="wrap">
  <h1>ランダム・ビンゴカード</h1>

  <div class="controls">
    <button id="newCardBtn" class="pink">新しいカードを作る</button>
    <button id="clearOpensBtn" class="secondary">開いたマスを全クリア</button>
    <button id="copyListBtn">番号リストをコピー</button>
  </div>

  <div id="board" class="board" aria-label="BINGO Board" role="grid"></div>

  <div class="legend">
    <span>↓ タップして「開いた」番号を表示（FREEは除外）</span>
    <span id="count">0 個</span>
  </div>
  <div id="called" class="called-box" aria-live="polite"></div>

  <div class="foot">※B列1–15 / I列16–30 / N列31–45(中央FREE) / G列46–60 / O列61–75</div>
</div>

<script>
(function(){
  const boardEl = document.getElementById('board');
  const calledEl = document.getElementById('called');
  const countEl  = document.getElementById('count');
  const newBtn   = document.getElementById('newCardBtn');
  const clearBtn = document.getElementById('clearOpensBtn');
  const copyBtn  = document.getElementById('copyListBtn');

  /** 乱数から配列をシャッフル */
  const shuffle = (arr) => arr.map(v=>[Math.random(), v])
                              .sort((a,b)=>a[0]-b[0]).map(v=>v[1]);

  /** 列ごとの範囲で一意の数を生成 */
  function columnNumbers(start, end, take) {
    const nums = Array.from({length: end-start+1}, (_,i)=>start+i);
    return shuffle(nums).slice(0, take);
  }

  /** カード生成（BINGOヘッダ+5x5セル） */
  function buildCard() {
    boardEl.innerHTML = '';
    const header = ['B','I','N','G','O'];

    // ヘッダ
    header.forEach(h=>{
      const el = document.createElement('div');
      el.className='head';
      el.textContent = h;
      el.setAttribute('role','columnheader');
      boardEl.appendChild(el);
    });

    // 列データ作成
    const cols = [
      columnNumbers(1, 15, 5),   // B
      columnNumbers(16, 30, 5),  // I
      columnNumbers(31, 45, 5),  // N
      columnNumbers(46, 60, 5),  // G
      columnNumbers(61, 75, 5)   // O
    ];

    // セル配置（行優先）
    for (let r=0; r<5; r++){
      for (let c=0; c<5; c++){
        const cell = document.createElement('button');
        cell.type='button';
        cell.className='cell';
        cell.setAttribute('role','gridcell');
        cell.dataset.col = header[c].toLowerCase();
        // 中央はFREE
        if (r===2 && c===2) {
          cell.textContent = 'FREE';
          cell.classList.add('free','open'); // 初期で開く
          cell.dataset.free = '1';
        } else {
          const num = cols[c][r];
          cell.textContent = num;
          cell.dataset.num = String(num);
          const badge = document.createElement('small');
          badge.textContent = header[c];
          cell.appendChild(badge);
        }
        boardEl.appendChild(cell);
      }
    }
  }

  /** 開いた番号の一覧を描画 */
  function renderCalled() {
    calledEl.innerHTML = '';
    const opened = [...boardEl.querySelectorAll('.cell.open')]
      .filter(el => !el.dataset.free && el.dataset.num);

    opened.forEach(el=>{
      const chip = document.createElement('span');
      chip.className = 'chip ' + (el.dataset.col||'');
      chip.textContent = (el.dataset.col||'').toUpperCase() + '-' + el.dataset.num;
      calledEl.appendChild(chip);
    });
    countEl.textContent = `${opened.length} 個`;
  }

  /** セルのタップ（開閉トグル） */
  function onCellClick(e){
    const t = e.target.closest('.cell');
    if (!t || t.classList.contains('head')) return;
    // FREEは開閉可（リスト対象外）
    if (t.classList.contains('open')) t.classList.remove('open');
    else t.classList.add('open');
    renderCalled();
  }

  /** すべての開いたセルを閉じる（FREEは開いたまま維持） */
  function clearOpens(){
    boardEl.querySelectorAll('.cell.open').forEach(el=>{
      if (el.dataset.free==='1') return; // FREEは残す
      el.classList.remove('open');
    });
    renderCalled();
  }

  /** 番号リストをテキスト化してコピー */
  function copyList(){
    const items = [...calledEl.querySelectorAll('.chip')].map(c=>c.textContent);
    const text = items.join(', ');
    if (!navigator.clipboard) {
      // fallback
      const ta = document.createElement('textarea');
      ta.value = text; document.body.appendChild(ta);
      ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
      alert('コピーしました：\n' + text);
      return;
    }
    navigator.clipboard.writeText(text).then(()=>{
      copyBtn.textContent = 'コピーしました！';
      setTimeout(()=>copyBtn.textContent='番号リストをコピー', 1200);
    });
  }

  // 初期化
  buildCard();
  // FREEは初期openなので初回描画
  renderCalled();

  // イベント
  boardEl.addEventListener('click', onCellClick, {passive:true});
  newBtn.addEventListener('click', ()=>{ buildCard(); renderCalled(); }, {passive:true});
  clearBtn.addEventListener('click', clearOpens, {passive:true});
  copyBtn.addEventListener('click', copyList, {passive:true});
})();
</script>
</body>
</html>

